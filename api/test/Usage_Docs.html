<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Factory Muffin</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="Enables The Rapid Creation Of Objects For Testing" />
    <meta name="author" content="Factory Muffin">
        <link rel="icon" href="img/favicon-blue.png" type="image/x-icon">
        <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>

    <!-- LESS -->
            <link rel="stylesheet" href="css/daux-blue.min.css">
    </head>
<body>
            <!-- Docs -->
                    <a href="https://github.com/thephpleague/factory-muffin" target="_blank" id="github-ribbon" class="hidden-print"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
                <div class="container-fluid fluid-height wrapper">
            <div class="navbar navbar-fixed-top hidden-print">
                <div class="container-fluid">
                    <a class="brand navbar-brand pull-left" href="index.html">Factory Muffin</a>
                    <p class="navbar-text pull-right">
                        Generated by <a href="http://daux.io">Daux.io</a>
                    </p>
                </div>
            </div>

            <div class="row columns content">
                <div class="left-column article-tree col-sm-3 hidden-print">
                    <!-- For Mobile -->
                    <div class="responsive-collapse">
                        <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                    </div>
                    <div id="sub-nav-collapse" class="sub-nav-collapse">
                        <!-- Navigation -->
                        <ul class="nav nav-list"><li><a href="./Introduction.html">Introduction</a></li><li><a href="./Usage_Docs.html">Usage Docs</a></li><li><a href="./Upgrading.html">Upgrading</a></li><li><a href="./Contributing.html">Contributing</a></li></ul>                                                    <div class="well well-sidebar">
                                <!-- Links -->
                                                                    <a href="https://github.com/thephpleague/factory-muffin" target="_blank">GitHub Repo</a><br>
                                                                    <a href="https://github.com/thephpleague/factory-muffin/issues" target="_blank">Help/Support/Bugs</a><br>
                                                                    <a href="https://github.com/GrahamCampbell" target="_blank">Graham Campbell</a><br>
                                                                    <a href="https://github.com/scottrobertson" target="_blank">Scott Robertson</a><br>
                                                                                                <!-- Twitter -->
                                                                    <div class="twitter">
                                                <hr/>
                                        <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=thephpleague&amp;show_count=false"></iframe>
                                    </div>
                                                                    <div class="twitter">
                                                <hr/>
                                        <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=grahamjcampbell&amp;show_count=false"></iframe>
                                    </div>
                                                                    <div class="twitter">
                                                <hr/>
                                        <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=scottymeuk&amp;show_count=false"></iframe>
                                    </div>
                                                            </div>
                                            </div>
                </div>
                <div class="right-column  content-area col-sm-9">
                    <div class="content-page">
                        <article>
                                                            <div class="page-header sub-header clearfix">
                                    <h1>Usage Docs                                                                            </h1>
                                        <span style="float: left; font-size: 10px; color: gray;">
                                            Sunday, August 10, 2014                                        </span>
                                        <span style="float: right; font-size: 10px; color: gray;">
                                            11:49 PM                                        </span>
                                </div>
                                                        <p>This is the usage guide for Factory Muffin 2.0. Within this guide, you will see "the <code>xyz</code> function can be called". You should assume that these functions should be called statically on the <code>League\FactoryMuffin\Facade</code> class. It should also be noted that you can see a real example at the end of the guide.</p>
<h2>The Facade</h2>
<p>The facade class (<code>League\FactoryMuffin\Facade</code>) should always be your main point of entry for communicating with Factory Muffin. It will dynamically proxy static method calls to the underlying factory instance. The other classes, including the factory class (<code>League\FactoryMuffin\Factory</code>), are not intended for direct public use. Also, note that all public methods that would have returned void, return the factory instance in order to support method chaining.</p>
<h2>Factory Definitions</h2>
<p>You can define model factories using the <code>define</code> function. You may call it like this: <code>League\FactoryMuffin\Facade::define('Fully\Qualifed\ModelName', array('foo' =&gt; 'bar'))</code>, where <code>foo</code> is the name of the attribute you want set on your model, and <code>bar</code> describes how you wish to generate the attribute. Please see the generators section for more information on how this works.</p>
<p>We have provided a nifty way for you to do this in your tests. PHPUnit provides a <code>setupBeforeClass</code> function. Within that function you can call <code>League\FactoryMuffin\Facade::loadFactories(__DIR__ . '/factories');</code>, and it will include all files in the factories folder. Within those php files, you can put your definitions (all your code that calls the define function). The <code>loadFactories</code> function will throw a <code>League\FactoryMuffin\Exceptions\DirectoryNotFoundException</code> exception if the directory you're loading is not found.</p>
<h2>Generators</h2>
<h4>Generic</h4>
<p>The generic generator will be the generator you use the most. It will communicate with the faker library in order to generate your attribute.</p>
<h5>Example 1</h5>
<p>There is a simple example of setting a few different attributes.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('MyModel', array(
    'foo'    =&gt; 'word',          // Set the foo attribute to a random word
    'name'   =&gt; 'firstNameMale', // Set the name attribute to a random male first name
    'email'  =&gt; 'email',         // Set the email attribute to a random email address
    'body'   =&gt; 'text',          // Set the body attribute to a random string of text
    'slogan' =&gt; 'sentence',      // Set the slogan attribute to a random sentence
));</code></pre>
<h5>Example 2</h5>
<p>This will set the <code>age</code> attribute to a random number between 20 and 40. Note how we're using the <code>;</code> here to pass multiple arguments to the faker method.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('MyModel', array(
    'age' =&gt; 'numberBetween|20;40',
));</code></pre>
<h5>Example 3</h5>
<p>This will set the <code>name</code> attribute to a random female first name. It will ensure that it is unique between all your generated models.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('MyModel', array(
    'name' =&gt; 'unique:firstNameFemale',
));</code></pre>
<h5>Example 4</h5>
<p>This will set the <code>profile_pic</code> attribute to a random image url of dimensions 400 by 400. Because we've added the optional flag at the start, not all the generated models will have an image url set; sometimes we will return null.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('MyModel', array(
    'profile_pic' =&gt; 'optional:imageUrl|400;400',
));</code></pre>
<h5>More</h5>
<p>Check out the <a href="https://github.com/fzaninotto/Faker">faker library</a> itself to see all the available methods. There are far too many to cover in the documentation here, and far too many for them to cover in their documentation too.</p>
<h4>Factory</h4>
<p>The factory generator can be useful for setting up relationships between models. The factory generator will return the model id of the model you ask it to generate.</p>
<h5>Example 1</h5>
<p>When we create a Foo object, we will find that the Bar object will been generated and saved too, and it's id will be assigned to the <code>bar_id</code> attribute of the Foo model.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('Foo', array(
    'bar_id' =&gt; 'factory|Bar'
));

League\FactoryMuffin\Facade::define('Bar', array(
    'baz' =&gt; 'date|Y-m-d'
));</code></pre>
<h4>Call</h4>
<p>The call generator allows you to generate attributes by calling <strong>static</strong> methods on your models.</p>
<h5>Example 1</h5>
<p>This will set the <code>foo</code> attribute to whatever calling <code>MyModel::exampleMethod()</code> returns.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('MyModel', array(
    'foo' =&gt; 'call|exampleMethod',
));</code></pre>
<h5>Example 2</h5>
<p>This will set the <code>bar</code> attribute to whatever calling <code>MyModel::anotherMethod('hello')</code> returns.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('MyModel', array(
    'bar' =&gt; 'call|anotherMethod|hello',
));</code></pre>
<h5>Example 3</h5>
<p>This will set the <code>baz</code> attribute to whatever calling the <code>exampleMethod</code> method on the <code>OtherModel</code> after we generate and save it.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('MyModel', array(
    'baz' =&gt; 'call|exampleMethod|factory|OtherModel',
));

League\FactoryMuffin\Facade::define('OtherModel', array(
    'example' =&gt; 'boolean',
));</code></pre>
<h4>Closure</h4>
<p>The closure generator can be used if you want a more custom solution. Whatever you return from the closure you write will be set as the attribute. Note that we pass an instance of your model as the first parameter of the closure to give you even more flexibility to modify it as you wish.</p>
<h5>Example 1</h5>
<p>As you can see from this example, the ability to use a closure to generate attributes can be so useful and flexible. Here we use it to generate a slug based on the initially randomly generated 5 word long title.</p>
<pre><code class="language-php">League\FactoryMuffin\Facade::define('MyModel', array(
    'title' =&gt; 'sentence|5',
    'slug' =&gt; function ($object) {
        $slug = preg_replace("/[^a-zA-Z0-9\/_|+ -]/", '', $object-&gt;title);
        $slug = strtolower(trim($slug, '-'));
        $slug = preg_replace("/[\/_|+ -]+/", '-', $slug);

        return $slug;
    },
));</code></pre>
<h2>Creating And Seeding</h2>
<p>The <code>create</code> function will create and save your model, and will also save anything you generate with the <code>Factory</code> generator too. If you want to create multiple instances, check out the seed <code>seed</code> function, which accepts an additional argument at the start which is the number of models to generate in the process. The <code>seed</code> function will effectively be calling the <code>create</code> function over and over. It should be noted that you can set a custom save function before you get going with the <code>setSaveMethod</code> function. Also, a reminder that the <code>instance</code> function is still available if you don't want database persistence.</p>
<p>You may encounter the following exceptions:</p>
<ul>
<li><code>League\FactoryMuffin\Exceptions\NoDefinedFactoryException</code> will be thrown if you try to create a model and you haven't defined a factory definition for it earlier.</li>
<li><code>League\FactoryMuffin\Exceptions\SaveFailedException</code> will be thrown if the save function on your model returns false.</li>
<li><code>League\FactoryMuffin\Exceptions\SaveMethodNotFoundException</code> will be thrown if the save function on your model does not exist.</li>
<li>Any other exception thrown by your model while trying to create or save it.</li>
</ul>
<p>There are 2 other helper functions available. You may call <code>saved</code> to return an array of all the saved objects. You may call <code>isSaved</code> with an instance of a model to check if it's saved.</p>
<h2>Deleting</h2>
<p>You can delete all your saved models with the <code>deleteSaved</code> function. It should be noted that you can set a custom delete function before you get going with the <code>setDeleteMethod</code> function.</p>
<p>If one or more models cannot be deleted, a <code>League\FactoryMuffin\Exceptions\DeletingFailedException</code> will be raised after we have attempted to delete all the saved models. You may access each underlying exception, in the order they were thrown during the whole process, with the <code>getExceptions</code> function which will return an array of exceptions. You may encounter the following exceptions:</p>
<ul>
<li><code>League\FactoryMuffin\Exceptions\DeleteFailedException</code> will be thrown if the delete function on your model returns false.</li>
<li><code>League\FactoryMuffin\Exceptions\DeleteMethodNotFoundException</code> will be thrown if the delete function on your model does not exist.</li>
<li>Any other exception thrown by your model while trying to delete it.</li>
</ul>
<p>It's recommended that you call the <code>deleteSaved</code> function from PHPUnit's <code>tearDownAfterClass</code> function.</p>
<h2>Exceptions</h2>
<p>Each exception is documented with the documentation for the functions that throw them.</p>
<p>You can see a diagram showing the exception hierarchy here:</p>
<p><img alt="diagram" style="width: 100%" src="https://cloud.githubusercontent.com/assets/2829600/3790579/8fc52572-1b0d-11e4-96b1-7f0eac0dc10d.png"></p>
<h2>Real Examples</h2>
<p>To start with, we need to create some definitions:</p>
<pre><code class="language-php"># tests/factories/all.php

use League\FactoryMuffin\Facade as FactoryMuffin;

FactoryMuffin::define('Message', array(
    'user_id'      =&gt; 'factory|User',
    'subject'      =&gt; 'sentence',
    'message'      =&gt; 'text',
    'phone_number' =&gt; 'randomNumber|8',
    'created'      =&gt; 'date|Ymd h:s',
    'slug'         =&gt; 'call|makeSlug|word',
));

FactoryMuffin::define('User', array(
    'username' =&gt; 'firstNameMale',
    'email'    =&gt; 'email',
    'avatar'   =&gt; 'imageUrl|400;600',
    'greeting' =&gt; RandomGreeting::get(),
    'four'     =&gt; function() {
        return 2 + 2;
    },
));</code></pre>
<p>You can then use these factories in your tests:</p>
<pre><code class="language-php"># tests/TestUserModel.php

use League\FactoryMuffin\Facade as FactoryMuffin;

class TestUserModel extends PHPUnit_Framework_TestCase
{
    public static function setupBeforeClass()
    {
        // note that method chaining is supported
        FactoryMuffin::setFakerLocale('en_EN')-&gt;setSaveMethod('save'); // optional step
        FactoryMuffin::loadFactories(__DIR__ . '/factories');
    }

    public function testSampleFactory()
    {
        $message = FactoryMuffin::create('Message');
        $this-&gt;assertInstanceOf('Message', $message);
        $this-&gt;assertInstanceOf('User', $message-&gt;user);
    }

    public static function tearDownAfterClass()
    {
        FactoryMuffin::setDeleteMethod('delete'); // optional step
        FactoryMuffin::deleteSaved();
    }
}</code></pre>
<h2>Further Information</h2>
<p>If you want more information, the following resources are available to you:</p>
<ul>
<li>Generated api docs are available <a href="http://muffin.grahamjcampbell.co.uk/">here</a>.</li>
<li><a href="https://github.com/philipbrown">Philip Brown's</a> article is available <a href="http://culttt.com/2013/05/27/laravel-4-fixture-replacement-with-factorymuff/">here</a>.</li>
<li>Our <a href="tests">test suite</a> may also be useful to you.</li>
</ul>                                                    </article>
                    </div>
                </div>
            </div>
        </div>
    


    <!-- hightlight.js -->
    <script src="js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- Navigation -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>
    if (typeof jQuery == 'undefined')
        document.write(unescape("%3Cscript src='js/jquery-1.11.0.min.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
        <script src="js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

</body>
</html>
